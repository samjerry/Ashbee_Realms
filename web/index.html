<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Twitch Adventure</title>
    <style>
      body { font-family: system-ui, sans-serif; margin: 0; background:#0b0d12; color:#e7e9ee; }
      #log { white-space: pre-wrap; padding: 16px; line-height: 1.4; }
      #inputbar { position: fixed; left:0; right:0; bottom:0; display:flex; gap:8px; padding:12px; background:#111521; }
      input[type=text]{ flex:1; padding:10px; border-radius:10px; border:1px solid #263045; background:#0f1422; color:#e7e9ee; }
      button{ padding:10px 14px; border-radius:10px; border:0; background:#2b6ef5; color:white; font-weight:600; }
      .sys{ color:#8fb3ff; }
      .event{ color:#ffd166; }
    </style>
  </head>
  <body>
    <div id="log"></div>
    <div id="inputbar">
      <input id="in" type="text" placeholder="Type commandsâ€¦ (e.g., explore, hunt, help)" />
      <button id="send">Send</button>
    </div>

    <script>
      const token = new URLSearchParams(location.search).get("t");
      const log = document.getElementById("log");
      function addLine(txt, cls=""){ const p=document.createElement("div"); p.className=cls; p.textContent=txt; log.appendChild(p); log.scrollTop = log.scrollHeight; }

      const ws = new WebSocket((location.protocol === "https:" ? "wss":"ws") + "://" + location.host + "/ws");
      ws.onopen = () => ws.send(JSON.stringify({token}));
      ws.onmessage = (e) => {
        const m = JSON.parse(e.data);
        if(m.type==="system") addLine(m.text, "sys");
        if(m.type==="log") addLine(m.text);
        if(m.type==="event") addLine(`[${m.event.toUpperCase()}] ${JSON.stringify(m.data)}`, "event");
      };

      const input = document.getElementById("in");
      const btn = document.getElementById("send");
      function send(){
        const text = input.value.trim(); if(!text) return;
        ws.send(JSON.stringify({type:"input", text}));
        input.value = "";
      }
      btn.onclick = send;
      input.addEventListener("keydown", e => { if(e.key==="Enter") send(); });
    </script>
  </body>
</html>
